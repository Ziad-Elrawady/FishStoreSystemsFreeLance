@model FishStoreSystem.ViewModels.CustomerDetailsViewModel
@{
    ViewData["Title"] = "كشف حساب";
}

<h2 class="text-center mb-4">📊 كشف حساب: @Model.Customer.Name</h2>

<h4 class="mt-4">الفواتير المفتوحة</h4>
@foreach(var inv in Model.OpenInvoices)
{
    <div class="card mb-3 shadow">
        <div class="card-header bg-warning">
            <strong>فاتورة #@inv.Id</strong> - تاريخ: @inv.InvoiceDate.ToShortDateString() - استحقاق: @inv.DueDate.ToShortDateString()
        </div>
        <div class="card-body">
            <p><strong>المبلغ الإجمالي:</strong> @inv.TotalAmount.ToString("C")</p>
            <p><strong>المتبقي:</strong> <span class="text-danger fw-bold">@inv.RemainingAmount.ToString("C")</span></p>
            
            <h6>الأصناف:</h6>
            <ul>
                @foreach(var item in inv.Items)
                {
                    <li>@item.ItemName - @item.Quantity كيلو × @item.UnitPrice = @item.TotalPrice.ToString("C")</li>
                }
            </ul>

            <hr />
            <form asp-controller="Invoices" asp-action="AddPayment" method="post" class="row g-3">
                <input type="hidden" name="invoiceId" value="@inv.Id" />
                <div class="col-md-4">
                    <input type="number" name="amount" class="form-control" placeholder="مبلغ الدفع" step="0.01" required />
                </div>
                <div class="col-md-4">
                    <select name="method" class="form-control">
                        <option value="كاش">كاش</option>
                        <option value="فيزا">فيزا</option>
                        <option value="تحويل">تحويل بنكي</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-success">➕ إضافة دفعة</button>
                </div>
            </form>

            @if (inv.Payments.Any())
            {
                <h6 class="mt-3">المدفوعات السابقة:</h6>
                <ul>
                    @foreach(var p in inv.Payments)
                    {
                        <li>@p.PaymentDate.ToShortDateString() - @p.Amount.ToString("C") (@p.PaymentMethod)</li>
                    }
                </ul>
            }
        </div>
    </div>
}

<a href="/Customers" class="btn btn-primary">🔙 العودة للقائمة</a>